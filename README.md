# スクールチャイム管理システム (School Chime Management System)

ブラウザ上で動作する、高機能なスクールチャイム管理アプリケーションです。時刻に合わせて自動でチャイムを再生するスケジュールの管理ができます。

![アプリケーションのスクリーンショット](https://github.com/AfterEffects-OK/SchoolChime/blob/main/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202025-12-15%20223946.png?raw=true)

## ✨ 主な機能

*   **多彩なスケジュール設定**:
    *   **繰り返し設定**: 毎週決まった曜日にチャイムを鳴らす設定ができます。（例: 毎週月曜〜金曜の8:30）
    *   **日付指定**: 特定の日付に一度だけチャイムを鳴らす設定ができます。（例: 2025年4月8日の始業式）

*   **柔軟な音源管理**:
    *   **GitHub直接アップロード (推奨)**: GitHub連携設定画面から、リポジトリへ直接音声ファイルをアップロード・保存できます。アップロードされたファイルは自動的にリストに追加され、永続的に使用できます。
    *   **URL指定**: Web上の音声ファイルURLを登録できます。この方法で追加した音源は設定がブラウザに保存されます。
        *   **クラウドストレージ対応**: Google Drive, Dropbox, OneDrive の共有リンクを貼り付けると、再生可能な形式に自動で変換して登録します。
            *   **Google Drive**: 100MBを超える大容量ファイル（ウイルススキャン警告が出るもの）の自動再生に対応しています。
            *   **OneDrive**: 共有リンクの変換ロジックを強化し、より確実に再生可能です。
    *   **ファイルアップロード**: PC上の音声ファイルを**ドラッグ＆ドロップ**で簡単に登録できます。（※通常はページ更新でリセットされますが、GitHub連携機能を使うことでクラウドに保存・復元が可能になります）

*   **高度な音声出力設定**:
    *   **全体出力設定**: アプリケーション全体の音声出力先（スピーカー/ヘッドフォン）を選択できます。
    *   **個別出力設定**: スケジュールごとに個別の出力先を指定できます。（例: 「朝のチャイム」は教室のスピーカー、「昼休み」は校庭のスピーカーなど）
    *   **仮想オーディオデバイス対応**: `VoiceMeeter` などの仮想オーディオデバイスへの出力も可能です。

*   **直感的な操作パネル**:
    *   **多機能ダッシュボード**: アナログ・デジタル時計での現在時刻表示に加え、次のチャイム予定やシステムの再生状態（待機中/再生中/エラー）をリアルタイムで確認できます。
    *   **手動再生パネル**: 登録した音源を、時間を問わずいつでも手動で再生・停止できます。音源の確認に便利です。
    *   **スケジュール管理**: 登録済みスケジュールの有効/無効の切り替え、テスト再生、**複製**、編集、削除が簡単に行えます。
    *   **ヘッダーコントロール**: ヘッダー右側のアイコン群から、以下の操作が可能です。
        *   **使い方表示**: はてなマークのアイコンで、いつでも使い方を確認できます。
        *   **シンプルモード切替**: 設定パネルの表示/非表示を切り替えます。設定パネルを隠した「シンプルモード」は、時計とシステムステータスのみが表示されるため、監視用ディスプレイでの利用に最適です。
        *   **テーマ切替**: 太陽と月のアイコンで、ライトモードとダークモードを切り替えます。

*   **データの永続化と共有**:
    *   作成したスケジュールや設定は、お使いのブラウザのローカルストレージに自動で保存されます。
    *   **インポート/エクスポート機能**: スケジュール設定をJSONファイルとして書き出し、他のPCで読み込むことができます。
        *   インポート時にIDを自動で再割り当てするため、既存のスケジュールと重複することなく安全に追加できます。
    *   **GitHub連携機能**:
        *   **音源データのクラウド保存**: 登録した音源リスト（URL設定および**アップロードした音声ファイル本体**）をGitHubリポジトリに保存・読み込みできます。
        *   **ドラッグ＆ドロップでアップロード**: GitHub連携画面に追加されたドロップエリアに音声ファイルを置くだけで、リポジトリの指定フォルダ（デフォルト: `audio/`）にアップロードされます。アップロード後は自動的にアプリの音源リストに追加されるため、手動でURLを登録する手間が省けます。
        *   **環境の同期**: 異なるPC間でも、GitHubを経由してチャイム音源の環境を簡単に同期・復元できます。（※スケジュール設定はローカルファイルのインポート/エクスポート機能をご利用ください）

*   **その他**:
    *   **誤操作防止（離脱防止）**: チャイム待機中に誤ってタブを閉じたりリロードしたりしようとすると、「このサイトを離れますか？」という確認ダイアログが表示されます。これにより、意図せずアプリが終了し、チャイムが鳴らなくなる事故を防ぎます。
    *   **再生精度の向上**: ブラウザがバックグラウンドにある場合やPCが高負荷な場合でも、設定時刻（分）内であれば確実にチャイムが鳴るように判定ロジックを実装しています。
    *   **シンプルモードの安定化**: シンプルモード（設定非表示）使用時でも、音声プレイヤーが確実に動作するように内部構造を最適化しています。
    *   **テスト音源の追加**: デフォルトで「テスト音声」が登録されており、スピーカーの動作確認がすぐに行えます。
    *   ダークモード対応。
    *   **音量ブースト機能**: スケジュールごとに音量を **0%〜150%** の範囲で調整できます。（※Google Driveなどの一部のクラウド音源は、セキュリティ制限により最大100%での再生となります）

---

## 🚀 使い方 (セットアップ方法)

このアプリケーションの全機能（特に音声デバイスの選択機能）を利用するには、**ローカル開発サーバー**経由で `index.html` を開く必要があります。

セキュリティ上の理由から、ファイルを直接ブラウザで開く (`file:///...` というアドレスになる方法) と、マイクやスピーカーのデバイス名が正しく取得できず、一部機能が制限されます。

### VS Code と Live Server を使う方法 (推奨)

プログラミング用のエディタ「Visual Studio Code」を使っている場合、以下の手順が最も簡単です。

1.  **Live Serverのインストール**:
    *   VS Codeの左側にある拡張機能アイコンをクリックします。
    *   検索バーに `Live Server` と入力し、Ritwick Dey作の拡張機能をインストールします。

2.  **サーバーの起動**:
    *   VS Codeで `index.html` ファイルを開きます。
    *   エディタ右下のステータスバーにある `Go Live` ボタンをクリックします。

    !Go Live button

3.  **ブラウザで確認**:
    *   自動的にブラウザが起動し、 `http://127.0.0.1:5500/index.html` のようなアドレスでページが表示されます。
    *   ページ上部にマイクへのアクセス許可を求めるポップアップが表示されたら、**「許可」** をクリックしてください。これにより、PCに接続されている全ての音声デバイスがドロップダウンリストに表示されるようになります。
    > **（補足）** もしファイルを直接ブラウザで開くと、アドレスが `file:///...` となり、セキュリティ制限によって音声デバイスの一覧が正しく表示されません。必ずローカルサーバー経由でアクセスしてください。
    > **なぜマイクの許可が必要？**
    > セキュリティ上の理由から、最近のブラウザはWebサイトがPCに接続されたデバイス（スピーカーやマイク）の詳しい名前を勝手に取得できないように設計されています。
    > しかし、一度ユーザーがマイクの使用を「許可」すると、ブラウザはこのサイトを信頼し、接続されているスピーカーの一覧（名前を含む）を正しく表示できるようになります。
    >
    > ※このアプリはスピーカー一覧の取得目的でのみ許可を求めており、マイクの音声を録音・送信することはありません。

### Python を使う方法

Pythonがインストールされている環境では、ターミナル（コマンドプロンプト）から以下のコマンドを実行することでも簡易サーバーを起動できます。

1.  ターミナルで `index.html` があるフォルダに移動します。
2.  以下のコマンドを実行します。
    ```bash
    # Python 3 の場合
    python -m http.server
    ```
    ```bash
    # Python 2 の場合
    python -m SimpleHTTPServer
    ```
3.  ブラウザを開き、アドレスバーに `http://localhost:8000` と入力してアクセスします。

### Node.js を使う方法

Node.jsがインストールされている場合は、`serve` パッケージを利用するのが便利です。

```bash
# 1. serveをインストール (初回のみ)
npm install -g serve
# 2. サーバーを起動
serve .
```
ブラウザで `http://localhost:3000` にアクセスします。

---

## OBSでの利用について

このアプリケーションはOBSの「ブラウザソース」として利用し、配信や録画にチャイム音を乗せることも可能です。ただし、OBSの特殊な環境のため、一部機能に制限があります。

### 機能の動作について

*   **⭕ 正常に動作する機能**
    *   スケジュールの管理・自動再生
    *   時計やステータスなどの表示機能
    *   ダークモード、シンプルモードの切り替え
    *   OBSの「対話」機能を使った画面操作

*   **❌ 制限・利用できない機能**
    *   **音声出力設定（最重要）**: アプリ内でどのスピーカーを選んでも、音声はすべてOBSの音声ミキサーに送られます。**特定の物理スピーカーから音を出すことはできません。**
    *   **インポート/エクスポート**: ファイルの保存や読み込みが正常に動作しません。
    *   **ファイルからの音源追加**: 動作が不安定なため、URLからの追加を推奨します。

### OBSでの推奨設定

1.  この`README`の案内に従い、PC上で**ローカル開発サーバーを起動**します。（例: `python -m http.server`）
2.  OBSで「ソース」を追加し、「ブラウザ」を選択します。
3.  URLにローカルサーバーのアドレス（例: `http://localhost:8000`）を入力します。
4.  プロパティ画面の下部にある**「OBS経由で音声を制御」にチェックを入れます。**

この設定により、OBSの「音声ミキサー」にブラウザソース用のメーターが表示され、OBS側で音量調整などが可能になります。

---

## 🛠️ 技術スタック

*   **UI**: React (CDN)
*   **Styling**: Tailwind CSS (CDN)
*   **Icons**: Lucide Icons
*   **Transpiler**: Babel (Standalone)

このアプリケーションはビルドプロセスを必要としませんが、保守性を高めるために HTML, JavaScript, CSS を別ファイルに分割して構成されています。

*   `index.html`: アプリケーションのメインファイル
*   `js/app.js`: アプリケーションのロジック (Reactコンポーネント)
*   `css/style.css`: 追加のスタイル定義

※ 実行する際は、これらのファイルとフォルダ構成を維持してください。